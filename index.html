<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TECHSTORE | الإحترافية في التسوق</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Cairo:wght@400;700;900&display=swap');
        body { font-family: 'Cairo', sans-serif; }
        .slider-img { width: 100%; height: 400px; object-fit: cover; display: none; }
        .slider-img.active { display: block; animation: fade 1s; }
        @keyframes fade { from {opacity: 0.4} to {opacity: 1} }
        .category-btn.active { background: #0088ff; color: white; }
        #details-modal { display: none; background: rgba(0,0,0,0.8); z-index: 100; }
    </style>
</head>
<body class="bg-gray-50">

<header class="bg-white border-b sticky top-0 z-50 p-4 shadow-sm">
    <div class="container mx-auto flex flex-wrap justify-between items-center gap-4">
        <div class="flex items-center gap-2 cursor-pointer" onclick="location.reload()">
            <div class="bg-blue-600 p-2 rounded-lg text-white"><i class="fa fa-bolt"></i></div>
            <h1 class="text-xl font-black">TECH<span class="text-blue-600">STORE</span></h1>
        </div>
        <div class="flex-1 max-w-md relative">
            <input id="search-input" oninput="searchProducts()" placeholder="ابحث عن منتج..." class="w-full border p-2 rounded-full px-5 outline-none focus:border-blue-500">
        </div>
        <div class="flex gap-4 items-center">
            <div onclick="toggleCart(true)" class="relative cursor-pointer"><i class="fa fa-shopping-cart text-2xl"></i><span id="cart-count" class="absolute -top-2 -right-2 bg-red-600 text-white text-[10px] rounded-full w-4 h-4 flex items-center justify-center">0</span></div>
            <i class="fa fa-user-circle text-2xl cursor-pointer" onclick="location.href='admin.html'"></i>
        </div>
    </div>
</header>

<nav class="bg-white shadow-sm border-b overflow-x-auto whitespace-nowrap scrollbar-hide">
    <div class="container mx-auto p-3 flex gap-4">
        <button onclick="filterCat('الكل', this)" class="category-btn active px-6 py-2 rounded-full border font-bold">الكل</button>
        <button onclick="filterCat('موبايلات', this)" class="category-btn px-6 py-2 rounded-full border font-bold">موبايلات</button>
        <button onclick="filterCat('لابتوبات', this)" class="category-btn px-6 py-2 rounded-full border font-bold">لابتوبات</button>
        <button onclick="filterCat('إكسسوارات', this)" class="category-btn px-6 py-2 rounded-full border font-bold">إكسسوارات</button>
    </div>
</nav>

<section class="container mx-auto mt-4 px-2">
    <div id="slider-container" class="relative rounded-2xl overflow-hidden shadow-xl h-[200px] md:h-[400px]">
        </div>
</section>

<main class="container mx-auto p-4 py-10">
    <div id="product-grid" class="grid grid-cols-2 md:grid-cols-4 lg:grid-cols-5 gap-6"></div>
</main>

<div id="details-modal" class="fixed inset-0 overflow-y-auto p-4">
    <div class="bg-white max-w-4xl mx-auto rounded-3xl p-6 relative mt-10">
        <button onclick="closeDetails()" class="absolute top-4 right-4 text-3xl">&times;</button>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
            <div>
                <img id="main-detail-img" class="w-full h-80 object-contain border rounded-2xl mb-4">
                <div id="alt-imgs" class="flex gap-2 overflow-x-auto"></div>
            </div>
            <div>
                <h2 id="detail-name" class="text-3xl font-black mb-4"></h2>
                <div id="detail-price" class="text-2xl font-bold text-blue-600 mb-6"></div>
                <p id="detail-desc" class="text-gray-600 mb-8 leading-relaxed"></p>
                <button id="add-to-cart-btn" class="w-full bg-blue-600 text-white py-4 rounded-xl font-black shadow-lg mb-8">إضافة للسلة</button>
                
                <div class="border-t pt-6">
                    <h3 class="font-bold mb-4 italic">التقييمات والتعليقات</h3>
                    <div id="comments-list" class="space-y-3 mb-4 max-h-40 overflow-y-auto"></div>
                    <div class="flex gap-2">
                        <input id="u-comment" placeholder="اكتب رأيك..." class="flex-1 border p-2 rounded-lg">
                        <button onclick="addComment()" class="bg-gray-800 text-white px-4 rounded-lg text-sm">إرسال</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    const DB = "https://tech-store-71bce-default-rtdb.firebaseio.com/";
    let allProducts = {}, currentID = "", cart = [];

    async function init() {
        // Load Slider
        const sRes = await fetch(DB + "ads.json");
        const sData = await sRes.json();
        const sCont = document.getElementById('slider-container');
        if(sData) {
            sCont.innerHTML = Object.values(sData).map((img, i) => `<img src="${img}" class="slider-img ${i===0?'active':''}">`).join('');
            startSlider();
        }

        // Load Products
        const pRes = await fetch(DB + "products.json");
        allProducts = await pRes.json() || {};
        renderProducts(allProducts);
    }

    function renderProducts(data) {
        const grid = document.getElementById('product-grid');
        grid.innerHTML = Object.keys(data).map(key => {
            const p = data[key];
            return `
            <div class="bg-white p-4 rounded-2xl shadow-sm border border-gray-100 text-center cursor-pointer" onclick="openDetails('${key}')">
                <img src="${p.mainImg}" class="h-40 w-full object-contain mb-3">
                <h4 class="font-bold text-sm h-10 overflow-hidden">${p.name}</h4>
                <div class="text-blue-600 font-black mt-2">${p.price} ج.م</div>
                <div class="text-yellow-400 text-xs mt-1">★★★★★</div>
            </div>`;
        }).join('');
    }

    function startSlider() {
        let i = 0;
        const imgs = document.querySelectorAll('.slider-img');
        if(imgs.length <= 1) return;
        setInterval(() => {
            imgs[i].classList.remove('active');
            i = (i + 1) % imgs.length;
            imgs[i].classList.add('active');
        }, 4000);
    }

    function filterCat(cat, btn) {
        document.querySelectorAll('.category-btn').forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
        if(cat === 'الكل') return renderProducts(allProducts);
        const filtered = Object.keys(allProducts).filter(k => allProducts[k].cat === cat).reduce((res, key) => (res[key] = allProducts[key], res), {});
        renderProducts(filtered);
    }

    function searchProducts() {
        const term = document.getElementById('search-input').value.toLowerCase();
        const filtered = Object.keys(allProducts).filter(k => allProducts[k].name.toLowerCase().includes(term)).reduce((res, key) => (res[key] = allProducts[key], res), {});
        renderProducts(filtered);
    }

    function openDetails(id) {
        currentID = id;
        const p = allProducts[id];
        document.getElementById('detail-name').innerText = p.name;
        document.getElementById('detail-price').innerText = p.price + " ج.م";
        document.getElementById('detail-desc').innerText = p.desc || "لا يوجد وصف";
        document.getElementById('main-detail-img').src = p.mainImg;
        
        const alts = document.getElementById('alt-imgs');
        alts.innerHTML = `<img src="${p.mainImg}" onclick="document.getElementById('main-detail-img').src=this.src" class="w-16 h-16 border rounded cursor-pointer">`;
        if(p.gallery) p.gallery.forEach(img => {
            alts.innerHTML += `<img src="${img}" onclick="document.getElementById('main-detail-img').src=this.src" class="w-16 h-16 border rounded cursor-pointer">`;
        });

        loadComments(id);
        document.getElementById('details-modal').style.display = 'block';
    }

    async function loadComments(id) {
        const res = await fetch(DB + `products/${id}/comments.json`);
        const data = await res.json();
        document.getElementById('comments-list').innerHTML = data ? Object.values(data).map(c => `<div class="bg-gray-50 p-2 rounded text-sm font-bold border-r-2 border-blue-500">${c}</div>`).join('') : "لا يوجد تعليقات بعد";
    }

    async function addComment() {
        const txt = document.getElementById('u-comment').value;
        if(!txt) return;
        await fetch(DB + `products/${currentID}/comments.json`, { method: 'POST', body: JSON.stringify(txt) });
        document.getElementById('u-comment').value = "";
        loadComments(currentID);
    }

    function closeDetails() { document.getElementById('details-modal').style.display = 'none'; }

    init();
</script>
</body>
</html>
