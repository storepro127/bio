<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>إدارة TECHSTORE</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<body class="bg-slate-50 font-['Cairo']">

<div id="login-box" class="max-w-md mx-auto mt-20 p-10 bg-white shadow-xl rounded-3xl text-center">
    <h2 class="text-2xl font-black mb-6">دخول الإدارة</h2>
    <input type="password" id="pass" placeholder="الرمز السري (11211)" class="w-full border p-4 rounded-2xl mb-4 text-center">
    <button onclick="login()" class="w-full bg-black text-white py-4 rounded-2xl font-bold">دخول</button>
</div>

<div id="admin-ui" class="hidden">
    <nav class="bg-slate-900 text-white p-4 flex gap-4 overflow-x-auto sticky top-0 z-50">
        <button onclick="sec('ads')" class="px-4 font-bold border-l">الإعلانات (Slider)</button>
        <button onclick="sec('add')" class="px-4 font-bold border-l">إضافة منتج</button>
        <button onclick="sec('orders')" class="px-4 font-bold">الأوردرات</button>
    </nav>

    <main class="container mx-auto p-6">
        <section id="ads-sec" class="hidden max-w-lg mx-auto bg-white p-6 rounded-2xl shadow">
            <h2 class="font-black mb-4">إضافة صور للسلايدر</h2>
            <input type="file" id="ad-file" class="w-full mb-4">
            <button onclick="uploadAd()" class="w-full bg-blue-600 text-white py-3 rounded-xl font-bold">رفع الإعلان</button>
            <div id="ads-list" class="mt-6 flex gap-2 overflow-x-auto"></div>
        </section>

        <section id="add-sec" class="hidden max-w-xl mx-auto bg-white p-8 rounded-2xl shadow">
            <h2 class="font-black mb-6">إضافة منتج بتفاصيله</h2>
            <div class="space-y-4">
                <input id="p-name" placeholder="اسم المنتج" class="w-full border p-3 rounded-xl">
                <select id="p-cat" class="w-full border p-3 rounded-xl">
                    <option value="موبايلات">موبايلات</option>
                    <option value="لابتوبات">لابتوبات</option>
                    <option value="إكسسوارات">إكسسوارات</option>
                </select>
                <input id="p-price" type="number" placeholder="السعر" class="w-full border p-3 rounded-xl">
                <textarea id="p-desc" placeholder="وصف المنتج التفصيلي" class="w-full border p-3 rounded-xl h-24"></textarea>
                
                <div class="border-2 border-dashed p-4 rounded-xl">
                    <p class="text-sm font-bold mb-2">الصورة الأساسية (Main Image):</p>
                    <input type="file" id="p-main" class="text-xs">
                </div>

                <div class="border-2 border-dashed p-4 rounded-xl">
                    <p class="text-sm font-bold mb-2">باقي الصور (أقصى حد 7):</p>
                    <input type="file" id="p-gallery" multiple class="text-xs">
                </div>

                <button id="add-btn" onclick="saveProduct()" class="w-full bg-slate-900 text-white py-4 rounded-xl font-black">حفظ المنتج في الداتا بيز</button>
            </div>
        </section>

        <section id="orders-sec" class="hidden">
            <h2 class="font-black mb-6 italic text-2xl">طلبات العملاء</h2>
            <div id="orders-list" class="space-y-4"></div>
        </section>
    </main>
</div>

<script>
    const DB = "https://tech-store-71bce-default-rtdb.firebaseio.com/";
    let mainBase64 = "", galleryBase64 = [];

    function login() { if(document.getElementById('pass').value === "11211") { document.getElementById('login-box').hidden = true; document.getElementById('admin-ui').classList.remove('hidden'); sec('ads'); } }

    function sec(s) { document.querySelectorAll('main > section').forEach(x => x.classList.add('hidden')); document.getElementById(s + '-sec').classList.remove('hidden'); if(s==='ads') loadAds(); if(s==='orders') loadOrders(); }

    // Image Handlers
    document.getElementById('p-main').onchange = e => { const r = new FileReader(); r.onload = () => mainBase64 = r.result; r.readAsDataURL(e.target.files[0]); };
    document.getElementById('p-gallery').onchange = e => {
        galleryBase64 = [];
        Array.from(e.target.files).slice(0, 7).forEach(file => {
            const r = new FileReader();
            r.onload = () => galleryBase64.push(r.result);
            r.readAsDataURL(file);
        });
    };

    async function saveProduct() {
        const btn = document.getElementById('add-btn'); btn.disabled = true; btn.innerText = "جاري الحفظ...";
        const data = {
            name: document.getElementById('p-name').value,
            cat: document.getElementById('p-cat').value,
            price: document.getElementById('p-price').value,
            desc: document.getElementById('p-desc').value,
            mainImg: mainBase64,
            gallery: galleryBase64
        };
        await fetch(DB + "products.json", { method: 'POST', body: JSON.stringify(data) });
        alert('تم الحفظ بنجاح!'); location.reload();
    }

    async function uploadAd() {
        const file = document.getElementById('ad-file').files[0];
        const r = new FileReader();
        r.onload = async () => {
            await fetch(DB + "ads.json", { method: 'POST', body: JSON.stringify(r.result) });
            loadAds();
        };
        r.readAsDataURL(file);
    }

    async function loadAds() {
        const res = await fetch(DB + "ads.json");
        const data = await res.json();
        document.getElementById('ads-list').innerHTML = data ? Object.keys(data).map(k => `<img src="${data[k]}" class="h-20 rounded border">`).join('') : "";
    }

    async function loadOrders() {
        const res = await fetch(DB + "orders.json");
        const data = await res.json();
        document.getElementById('orders-list').innerHTML = data ? Object.keys(data).reverse().map(k => `
            <div class="bg-white p-4 rounded-xl border-r-4 border-blue-500 shadow-sm flex justify-between">
                <div><b>${data[k].customer}</b> - ${data[k].phone}<br>${data[k].address}</div>
                <div class="font-black text-blue-600">${data[k].total} ج.م</div>
                <button onclick="del('orders/${k}')" class="text-red-500">مسح</button>
            </div>`).join('') : "لا يوجد طلبات حالياً";
    }

    async function del(path) { if(confirm('متأكد؟')) { await fetch(DB + path + ".json", { method: 'DELETE' }); location.reload(); } }
</script>
</body>
</html>
